<div class="clients-container">
  <div class="header-bar">
    <h2>Liste des Clients</h2>
    <div class="actions">
      <button class="btn" (click)="goToDashboard()">🏠 Retour Dashboard</button>
      <button class="btn" (click)="exportToPdf()">📄 Export PDF</button>
      <button class="btn" (click)="exportToExcel()">📊 Export Excel</button>
      <button class="btn" (click)="toggleAdminPrompt()">⚙️ CRUD</button>
    </div>
  </div>

  <!-- ✅ Messages de succès ou d’erreur -->
  <div *ngIf="messageSuccess" class="alert success-alert">
    ✅ {{ messageSuccess }}
  </div>
  <div *ngIf="messageError" class="alert error-alert">
    ❌ {{ messageError }}
  </div>

  <input
    type="text"
    [(ngModel)]="searchText"
    placeholder="🔍 Rechercher un client..."
    class="search-input"
  />

  <!-- Formulaire affiché uniquement si showAdminPrompt est true -->
  <form *ngIf="showAdminPrompt" (submit)="validerCodeAdmin()" autocomplete="off" class="admin-code-form">
    <input
      type="password"
      [(ngModel)]="adminCode"
      name="adminCode"
      placeholder="Entrez le code admin"
      class="search-input"
      style="max-width: 250px"
      autocomplete="off"
    />
    <button class="btn" type="submit">Valider</button>
  </form>

  <!-- Bouton ajout client -->
  <button class="btn-add" (click)="ajouterClient()">➕ Ajouter un client</button>

  <!-- Grille des cartes -->
  <div class="card-grid">
    <div class="card" *ngFor="let client of filteredClients">
      <div class="icon-container">
        <img src="assets/client-icon.png" alt="Client Icon" />
      </div>
      <h3>{{ client.nom }} {{ client.prenom }}</h3>
      <p><strong>Code Client :</strong> {{ client.codeClient }}</p>
      <p><strong>Compte :</strong> {{ client.numeroCompte }}</p>
      <p>
        <strong>Solde :</strong>
        <span [ngClass]="client.solde >= 0 ? 'badge-positive' : 'badge-negative'">
          {{ client.solde | number: '1.2-2' }} F CFA
        </span>
      </p>
      <div class="card-buttons" *ngIf="showCrudButtons">
        <button class="btn-modifier" (click)="modifierClient(client)">✏️ Modifier</button>
        <button class="btn-supprimer" (click)="supprimerClient(client.codeClient)">🗑️ Supprimer</button>
      </div>
    </div>
  </div>

  <!-- Modale ajout -->
  <app-add-client
    *ngIf="showAddModal"
    (clientAdded)="onClientAdded($event)"
    (close)="showAddModal = false">
  </app-add-client>

  <!-- Modale modification -->
  <app-edit-client
    *ngIf="clientToEdit"
    [client]="clientToEdit"
    (clientUpdated)="onClientUpdated($event)"
    (close)="clientToEdit = null">
  </app-edit-client>

  <!-- 🔴 Modale de confirmation de suppression -->
  <div class="modal-backdrop" *ngIf="showDeleteConfirmModal">
    <div class="modal">
      <h2>⚠️ Confirmation</h2>
      <p>Voulez-vous vraiment supprimer le client <strong>{{ clientToDelete?.nom }} {{ clientToDelete?.prenom }}</strong> ?</p>

      <div class="modal-buttons">
        <button class="btn-cancel" (click)="annulerSuppression()">Annuler</button>
        <button class="btn-save" (click)="confirmerSuppression()">Oui, supprimer</button>
      </div>
    </div>
  </div>
</div>
